# Agent Change Logs

## [v0.0.1] 2026.01.14 - now

- 初始化项目，创建基础架构和文件夹结构。
- 在 `lib/src/app.dart` 新增基础页面框架，包含训练计划与历史记录的底部导航栏。
- 创建 `lib/src/models`、`lib/src/services`、`lib/src/provider`、`lib/src/view` 目录并将页面拆分到 view 下。
- 设计训练计划页面样式，新增训练计划状态管理与模型，并将页面迁移到 `lib/src/view/training`。
- 调整训练页面布局，让蓝色头部覆盖状态栏区域并统一状态栏样式。
- 移除应用壳层 AppBar，避免覆盖训练页顶部设计。
- 训练页面头部改为可滚动折叠的紧凑模式，滚动时切换为横向布局。
- 训练页头部改为随页面滚动，并在滚动超过阈值时展示紧凑模式头部。
- 修复训练页顶部头部组件的变量重复与布局语法错误。
- 训练页顶部蓝色内容块改为最小高度约束，避免布局溢出报错。
- 移除训练计划列表与新增逻辑，精简训练页面结构与状态。
- 移除训练页顶部蓝色内容块的折叠/紧凑模式切换逻辑。
- 重构训练时长调整卡片为滚动选择分钟与秒，限制范围并保留循环调整卡片。
- 回退训练时长滚动选择改动，恢复原有加减按钮布局。
- 训练计划数值卡片的名称与时间信息改为水平排列。
- 训练计划数值卡片文字区域改为垂直居中并基线对齐。
- 训练计划名称输入框增加边框与编辑图标强化可编辑提示。
- 训练计划名称输入框改为下划线样式并在末尾增加编辑图标。
- 训练计划名称输入框收缩为文字宽度，图标更贴近且下划线不再超出文字。
- 训练计划名称输入框提示文字改为灰色，下划线宽度随当前显示文本变化。
- 训练计划名称输入框增加左右 6 的内边距。
- 训练计划名称输入框下划线宽度包含左右内边距。
- 训练计划页面顶部改为 SliverAppBar 承载可展开头部。
- 训练计划页修正头部溢出并在折叠时改为水平布局与蓝牙图标按钮。
- 训练计划页头部移除额外顶部内边距，改用 SafeArea 处理安全区域。
- 训练计划页将 SliverAppBar 相关尺寸参数集中管理便于调整。
- 训练计划页顶部高度改为根据头部内容自动测量适配。
- 训练计划页折叠态内容改为 SliverAppBar 标题层展示以避免滚动异常。
- 清理训练计划页头部未使用的折叠参数与分支逻辑。
- 训练计划页开始按钮固定在底部并为滚动内容预留空间。
- 将训练计划页面重命名为计时训练页面，并同步更新页面类名与引用。
- 训练页新增计划选择弹窗，支持选择计划、编辑排序、批量删除与新增计划。
- 训练页调整计划内容后自动同步到计划列表，并完善默认计划与编辑状态退出逻辑。
- 修正训练页监听状态的时机，避免启动时因 Riverpod 监听异常导致空白页面。
- 计划选择弹窗新增编辑态全选按钮，并优化默认计划删除后的自动创建与弹窗尺寸上限。
- 调整计划选择弹窗布局计算，避免弹窗打开时布局卡顿并完善删除默认计划后的自动退出。
- 计划选择弹窗在未达上限时禁用滚动，并在编辑态隐藏标题且对齐左右按钮宽度。
- 训练页名称输入支持多行显示，计划弹窗列表项根据名称长度自适应高度。
- 训练页与计划弹窗名称在可容纳时保持单行，超出宽度后自动换行并扩展高度。
- 修正弹窗列表宽度计算，确保超长名称导致的行高变化参与滚动判断。
- 修复弹窗列表高度未计入内边距导致内容截断的问题。
- 校准列表行高计算，纳入分隔线与复选框高度避免末项被裁切。
- 完全移除弹窗列表上下留白，并相应调整高度计算避免列表被遮挡。
- 计划选择弹窗改用 LayoutBuilder 取实际可用尺寸，并统一列表为可滚动以避免高度估算导致裁切。
- 计划选择弹窗高度上限调整为屏幕高度的 60%%，并清理未使用的尺寸参数。
- 计划选择弹窗关闭时同步当前激活计划到主页显示。
- 移除训练计划库状态中的 nextPlanNumber 字段及相关更新逻辑。
- 开始按钮改为圆形播放图标样式。
- 底部开始按钮改为固定圆形尺寸并居中，避免图标溢出影响布局。
- 底部开始按钮改为居中浮动按钮，避免占满整行并确保图标居中显示。
- 底部浮动按钮改为椭圆“开始”按钮样式。
- 新增训练计划模型与本地存储服务，支持计划列表与当前选择持久化到本地。
- 训练计划库初始化时尝试从本地恢复数据，并在新增、删除、排序、选择及更新计划时同步保存。
- 引入 shared_preferences 依赖用于本地持久化存储。
- 应用启动恢复计划库后，同步将当前激活计划应用到主页显示。
- 主页初始化时显式监听训练计划库，确保应用启动后能恢复并展示上次激活计划。
- 训练页新增自由训练切换状态，标题区在自由训练时合并显示“自由训练”，并切换隐藏计划配置内容只保留返回计划训练按钮。
- 扩展头部将蓝牙按钮放置底部，标题与时长在剩余空间垂直居中显示。
- 训练页自由/计划训练选择状态纳入计划库状态持久化，应用启动后恢复上次训练模式。
- 新增训练监控页，进入后切换横屏并模拟蓝牙读数折线图与进度条，同时开始按钮跳转至监控页。
- 修复训练监控页采样定时器的 const Duration 常量表达式报错。
- 训练监控页退出按钮改为带背景的显式样式，确保在图表上可见。
- 训练监控页顶部工具栏改为右对齐紧凑按钮布局。
- 训练监控页折线图新增动态Y轴上限规则，填充区域右下角跟随当前时间点而非整段末尾。
- 训练监控页折线填充区域左下角从 y 轴开始，避免从首个采样点起填充。
- 训练监控页移除图表与进度条左右内边距，改为上下分区布局，进度条铺满底部区域。
- 训练监控页锻炼初始阶段从第0秒起线性升高，不再使用围绕0.5秒的起始波动逻辑。
- 训练监控页无论阶段都从 50kg 作为 y 轴初始上限，按规则动态上调。
- 训练监控页每次阶段开始预置 0 秒采样点，消除折线左侧起始空隙。
- 训练监控页调整绘制顺序，让折线覆盖最大值竖线。
- 训练监控页最大值竖线改为灰色并添加最大值圆点与标注文本。
- 训练监控页最大值竖线改为灰色，线从底部到最大值点，并在最大值处添加圆点与“最大值 kg”标注。
- 训练监控页进度条时间显示改为整秒。
- 训练监控页实时读数加入 EMA 平滑以提升视觉流畅度。
- 训练监控页图表区域增加 RepaintBoundary，减少非图表区域重绘以缓解卡顿。
- 训练监控页改用 Ticker + lerp 平滑插值渲染，采样频率与绘制频率解耦以减轻停顿感。
- 训练监控页使用同一显示时间驱动进度条与折线图末端，确保 x 轴同步。
- 修复折线绘制中 clampedLiveTime 的类型转换错误。
- 训练监控页引入显示时间延迟与插值渲染，允许绘制滞后 0.1 秒并提升折线流畅度。
- 训练监控页补充 ValueListenable 相关导入，修复未定义类型报错。
- 训练监控页进度条改用显示时间驱动，确保与折线 x 轴保持对齐。
- 训练监控页将折线绘制滞后时间调至 0.03 秒，降低可感知延迟。
- 训练监控页最大值竖线改为一旦出现就固定显示，直到新最大值出现。
- 训练监控页最大值标记改为与滞后显示时间同步，避免提前显示。
- 训练监控页新增可见最大值缓存，避免新最大值未到达显示时间时竖线消失。
- 训练监控页最大值改按显示时间内数据计算，增长阶段也同步显示且不再出现间隔消失。
- 训练监控页新增默认 3 秒准备阶段，使用蓝色并且仅出现一次。
- 训练监控页进度条时间改为倒计时显示。
- 顶部标题可能被工具栏遮挡时，测量工具栏宽度并自动切换竖排布局。
- 训练监控页补充 RenderProxyBox 相关导入，修复测量组件继承报错。
- 顶部标题遮挡判断改为基于左右较大保留区的居中可用宽度，提升触发准确性。
- 训练监控页顶部区改为悬浮布局，左/中/右元素不再占用主内容高度。
- 顶部悬浮区按遮挡情况切换工具栏竖排，并在必要时将标题改为两行显示。
- 顶部悬浮区提升绘制层级并补回高度测量，确保显示优先级最高。
- 训练监控页清理未使用字段并更新文本缩放 API，确保分析通过。
- 训练页开始按钮恢复跳转至训练监控页。
- 训练监控页顶部浮层移除固定高度计算，改为按内容自然撑开。
- 顶部标题改为依据返回按钮高度垂直居中，并同步调整工具栏高度规则。
- 训练监控页竖排工具栏高度改为按测量值与默认值取最大，避免高度不足。
- 训练监控页竖排工具栏改为不设高度限制，随内容自然撑开。
- 训练监控页补回竖排工具栏高度缓存字段，修复未定义变量报错。
- 训练监控页移除竖排工具栏高度限制与相关缓存，避免冗余与报错。
- 训练监控页移除横排工具栏高度限制，改为自然高度展示。
- 训练监控页移除返回按钮固定高度与背景色，简化顶部布局。
- 训练监控页读取返回按钮实际高度并用于标题高度居中对齐。
- 训练监控页新增最后循环不进入休息并在折线绘制完成后显示结算画面，包含计划汇总与最大/平均/中位数统计。
- 训练监控页补充训练计划模型导入，修复 TrainingPlanState 未定义报错。
- 训练监控页结算总时长计算改为使用整型休息循环数，修复 num 赋值给 int 的报错。
- 训练监控页结算时隐藏顶部工具栏与返回按钮，仅保留结算页关闭按钮并新增“已完成”标题。
- 结算页标题高度改为跟随关闭按钮测量值居中对齐。
- 结算页标题与关闭按钮统一顶部内边距，确保同一水平高度对齐。
- 新增训练记录数据模型与存储/Provider，训练结束时保存锻炼阶段原始采样与统计数据。
- 记录页展示训练记录列表，包含名称/时间/统计数据，并支持进入详情查看。
- 训练监控页拆分为图表、工具栏、进度条、结算层与测量工具等独立组件文件，主页面仅保留状态与流程逻辑。
- 训练监控页移除无用的峰值/最大时间字段，简化相位重置与图表参数传递。
- 训练计划页抽离头部、计划表单与计划选择弹窗组件，修正监控页路由引用路径。
- 训练记录页抽离记录卡片与详情页组件，并提取记录时间/时长格式化工具。
- 记录页列表分隔回调改为单下划线命名，避免多下划线占位符。
- 训练监控图表组件补充 foundation 引入，修复 ValueListenable 未定义报错。
- 测量尺寸组件将 RenderObject 类型改为公开，修复公共 API 使用私有类型的分析警告。
- 训练计划页替换为拆分后的头部/表单/计划选择组件，并移除原有内嵌组件定义。
- 训练监控页改用拆分后的图表/工具栏/进度条/结算层/测量组件，并清理对应内嵌组件实现。
- 记录页改用拆分后的记录卡片与详情页组件，删除内嵌组件与格式化函数。
