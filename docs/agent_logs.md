# Agent Change Logs

## [v0.0.1] 2026.01.14 - 2026.01.21

- 初始化项目，创建基础架构和文件夹结构。
- 在 `lib/src/app.dart` 新增基础页面框架，包含训练计划与历史记录的底部导航栏。
- 创建 `lib/src/models`、`lib/src/services`、`lib/src/provider`、`lib/src/view` 目录并将页面拆分到 view 下。
- 设计训练计划页面样式，新增训练计划状态管理与模型，并将页面迁移到 `lib/src/view/training`。
- 调整训练页面布局，让蓝色头部覆盖状态栏区域并统一状态栏样式。
- 移除应用壳层 AppBar，避免覆盖训练页顶部设计。
- 训练页面头部改为可滚动折叠的紧凑模式，滚动时切换为横向布局。
- 训练页头部改为随页面滚动，并在滚动超过阈值时展示紧凑模式头部。
- 修复训练页顶部头部组件的变量重复与布局语法错误。
- 训练页顶部蓝色内容块改为最小高度约束，避免布局溢出报错。
- 移除训练计划列表与新增逻辑，精简训练页面结构与状态。
- 移除训练页顶部蓝色内容块的折叠/紧凑模式切换逻辑。
- 重构训练时长调整卡片为滚动选择分钟与秒，限制范围并保留循环调整卡片。
- 回退训练时长滚动选择改动，恢复原有加减按钮布局。
- 训练计划数值卡片的名称与时间信息改为水平排列。
- 训练计划数值卡片文字区域改为垂直居中并基线对齐。
- 训练计划名称输入框增加边框与编辑图标强化可编辑提示。
- 训练计划名称输入框改为下划线样式并在末尾增加编辑图标。
- 训练计划名称输入框收缩为文字宽度，图标更贴近且下划线不再超出文字。
- 训练计划名称输入框提示文字改为灰色，下划线宽度随当前显示文本变化。
- 训练计划名称输入框增加左右 6 的内边距。
- 训练计划名称输入框下划线宽度包含左右内边距。
- 训练计划页面顶部改为 SliverAppBar 承载可展开头部。
- 训练计划页修正头部溢出并在折叠时改为水平布局与蓝牙图标按钮。
- 训练计划页头部移除额外顶部内边距，改用 SafeArea 处理安全区域。
- 训练计划页将 SliverAppBar 相关尺寸参数集中管理便于调整。
- 训练计划页顶部高度改为根据头部内容自动测量适配。
- 训练计划页折叠态内容改为 SliverAppBar 标题层展示以避免滚动异常。
- 清理训练计划页头部未使用的折叠参数与分支逻辑。
- 训练计划页开始按钮固定在底部并为滚动内容预留空间。
- 将训练计划页面重命名为计时训练页面，并同步更新页面类名与引用。
- 训练页新增计划选择弹窗，支持选择计划、编辑排序、批量删除与新增计划。
- 训练页调整计划内容后自动同步到计划列表，并完善默认计划与编辑状态退出逻辑。
- 修正训练页监听状态的时机，避免启动时因 Riverpod 监听异常导致空白页面。
- 计划选择弹窗新增编辑态全选按钮，并优化默认计划删除后的自动创建与弹窗尺寸上限。
- 调整计划选择弹窗布局计算，避免弹窗打开时布局卡顿并完善删除默认计划后的自动退出。
- 计划选择弹窗在未达上限时禁用滚动，并在编辑态隐藏标题且对齐左右按钮宽度。
- 训练页名称输入支持多行显示，计划弹窗列表项根据名称长度自适应高度。
- 训练页与计划弹窗名称在可容纳时保持单行，超出宽度后自动换行并扩展高度。
- 修正弹窗列表宽度计算，确保超长名称导致的行高变化参与滚动判断。
- 修复弹窗列表高度未计入内边距导致内容截断的问题。
- 校准列表行高计算，纳入分隔线与复选框高度避免末项被裁切。
- 完全移除弹窗列表上下留白，并相应调整高度计算避免列表被遮挡。
- 计划选择弹窗改用 LayoutBuilder 取实际可用尺寸，并统一列表为可滚动以避免高度估算导致裁切。
- 计划选择弹窗高度上限调整为屏幕高度的 60%%，并清理未使用的尺寸参数。
- 计划选择弹窗关闭时同步当前激活计划到主页显示。
- 移除训练计划库状态中的 nextPlanNumber 字段及相关更新逻辑。
- 开始按钮改为圆形播放图标样式。
- 底部开始按钮改为固定圆形尺寸并居中，避免图标溢出影响布局。
- 底部开始按钮改为居中浮动按钮，避免占满整行并确保图标居中显示。
- 底部浮动按钮改为椭圆“开始”按钮样式。
- 新增训练计划模型与本地存储服务，支持计划列表与当前选择持久化到本地。
- 训练计划库初始化时尝试从本地恢复数据，并在新增、删除、排序、选择及更新计划时同步保存。
- 引入 shared_preferences 依赖用于本地持久化存储。
- 应用启动恢复计划库后，同步将当前激活计划应用到主页显示。
- 主页初始化时显式监听训练计划库，确保应用启动后能恢复并展示上次激活计划。
- 训练页新增自由训练切换状态，标题区在自由训练时合并显示“自由训练”，并切换隐藏计划配置内容只保留返回计划训练按钮。
- 扩展头部将蓝牙按钮放置底部，标题与时长在剩余空间垂直居中显示。
- 训练页自由/计划训练选择状态纳入计划库状态持久化，应用启动后恢复上次训练模式。
- 新增训练监控页，进入后切换横屏并模拟蓝牙读数折线图与进度条，同时开始按钮跳转至监控页。
- 修复训练监控页采样定时器的 const Duration 常量表达式报错。
- 训练监控页退出按钮改为带背景的显式样式，确保在图表上可见。
- 训练监控页顶部工具栏改为右对齐紧凑按钮布局。
- 训练监控页折线图新增动态Y轴上限规则，填充区域右下角跟随当前时间点而非整段末尾。
- 训练监控页折线填充区域左下角从 y 轴开始，避免从首个采样点起填充。
- 训练监控页移除图表与进度条左右内边距，改为上下分区布局，进度条铺满底部区域。
- 训练监控页锻炼初始阶段从第0秒起线性升高，不再使用围绕0.5秒的起始波动逻辑。
- 训练监控页无论阶段都从 50kg 作为 y 轴初始上限，按规则动态上调。
- 训练监控页每次阶段开始预置 0 秒采样点，消除折线左侧起始空隙。
- 训练监控页调整绘制顺序，让折线覆盖最大值竖线。
- 训练监控页最大值竖线改为灰色并添加最大值圆点与标注文本。
- 训练监控页最大值竖线改为灰色，线从底部到最大值点，并在最大值处添加圆点与“最大值 kg”标注。
- 训练监控页进度条时间显示改为整秒。
- 训练监控页实时读数加入 EMA 平滑以提升视觉流畅度。
- 训练监控页图表区域增加 RepaintBoundary，减少非图表区域重绘以缓解卡顿。
- 训练监控页改用 Ticker + lerp 平滑插值渲染，采样频率与绘制频率解耦以减轻停顿感。
- 训练监控页使用同一显示时间驱动进度条与折线图末端，确保 x 轴同步。
- 修复折线绘制中 clampedLiveTime 的类型转换错误。
- 训练监控页引入显示时间延迟与插值渲染，允许绘制滞后 0.1 秒并提升折线流畅度。
- 训练监控页补充 ValueListenable 相关导入，修复未定义类型报错。
- 训练监控页进度条改用显示时间驱动，确保与折线 x 轴保持对齐。
- 训练监控页将折线绘制滞后时间调至 0.03 秒，降低可感知延迟。
- 训练监控页最大值竖线改为一旦出现就固定显示，直到新最大值出现。
- 训练监控页最大值标记改为与滞后显示时间同步，避免提前显示。
- 训练监控页新增可见最大值缓存，避免新最大值未到达显示时间时竖线消失。
- 训练监控页最大值改按显示时间内数据计算，增长阶段也同步显示且不再出现间隔消失。
- 训练监控页新增默认 3 秒准备阶段，使用蓝色并且仅出现一次。
- 训练监控页进度条时间改为倒计时显示。
- 顶部标题可能被工具栏遮挡时，测量工具栏宽度并自动切换竖排布局。
- 训练监控页补充 RenderProxyBox 相关导入，修复测量组件继承报错。
- 顶部标题遮挡判断改为基于左右较大保留区的居中可用宽度，提升触发准确性。
- 训练监控页顶部区改为悬浮布局，左/中/右元素不再占用主内容高度。
- 顶部悬浮区按遮挡情况切换工具栏竖排，并在必要时将标题改为两行显示。
- 顶部悬浮区提升绘制层级并补回高度测量，确保显示优先级最高。
- 训练监控页清理未使用字段并更新文本缩放 API，确保分析通过。
- 训练页开始按钮恢复跳转至训练监控页。
- 训练监控页顶部浮层移除固定高度计算，改为按内容自然撑开。
- 顶部标题改为依据返回按钮高度垂直居中，并同步调整工具栏高度规则。
- 训练监控页竖排工具栏高度改为按测量值与默认值取最大，避免高度不足。
- 训练监控页竖排工具栏改为不设高度限制，随内容自然撑开。
- 训练监控页补回竖排工具栏高度缓存字段，修复未定义变量报错。
- 训练监控页移除竖排工具栏高度限制与相关缓存，避免冗余与报错。
- 训练监控页移除横排工具栏高度限制，改为自然高度展示。
- 训练监控页移除返回按钮固定高度与背景色，简化顶部布局。
- 训练监控页读取返回按钮实际高度并用于标题高度居中对齐。
- 训练监控页新增最后循环不进入休息并在折线绘制完成后显示结算画面，包含计划汇总与最大/平均/中位数统计。
- 训练监控页补充训练计划模型导入，修复 TrainingPlanState 未定义报错。
- 训练监控页结算总时长计算改为使用整型休息循环数，修复 num 赋值给 int 的报错。
- 训练监控页结算时隐藏顶部工具栏与返回按钮，仅保留结算页关闭按钮并新增“已完成”标题。
- 结算页标题高度改为跟随关闭按钮测量值居中对齐。
- 结算页标题与关闭按钮统一顶部内边距，确保同一水平高度对齐。
- 新增训练记录数据模型与存储/Provider，训练结束时保存锻炼阶段原始采样与统计数据。
- 记录页展示训练记录列表，包含名称/时间/统计数据，并支持进入详情查看。
- 训练监控页拆分为图表、工具栏、进度条、结算层与测量工具等独立组件文件，主页面仅保留状态与流程逻辑。
- 训练监控页移除无用的峰值/最大时间字段，简化相位重置与图表参数传递。
- 训练计划页抽离头部、计划表单与计划选择弹窗组件，修正监控页路由引用路径。
- 训练记录页抽离记录卡片与详情页组件，并提取记录时间/时长格式化工具。
- 记录页列表分隔回调改为单下划线命名，避免多下划线占位符。
- 训练监控图表组件补充 foundation 引入，修复 ValueListenable 未定义报错。
- 测量尺寸组件将 RenderObject 类型改为公开，修复公共 API 使用私有类型的分析警告。
- 训练计划页替换为拆分后的头部/表单/计划选择组件，并移除原有内嵌组件定义。
- 训练监控页改用拆分后的图表/工具栏/进度条/结算层/测量组件，并清理对应内嵌组件实现。
- 记录页改用拆分后的记录卡片与详情页组件，删除内嵌组件与格式化函数。
- 训练记录模型新增分组采样结构，并在保存训练记录时按循环分组实时采样。
- 训练详情页优先按分组展示原始数据，缺少分组时回退为扁平列表。
- 训练记录模型移除扁平 samples 字段，训练数据仅保留按循环分组的采样。
- 训练详情页仅展示分组采样数据，删除旧记录回退逻辑。
- 记录页新增左滑删除交互，删除后同步移除记录并持久化。
- 训练监控进度条填充改为强制展开，恢复颜色填充显示。
- 训练计划页新增设备连接模拟状态，点击连接切换为已连接并将按钮文字/颜色同步为断开样式。
- 设备连接状态图标改为 link/link_off，并在卡片与顶部按钮保持一致。
- 设备连接图标颜色调整为未连接灰色、已连接蓝色。
- 训练监控页根据设备连接状态切换实时/离线面板，离线时移除实时拉力与锻炼折线，并在结算页隐藏统计数据。
- 离线训练模式下准备/休息阶段移除折线背景。
- 训练监控页各阶段中心文本改为对应颜色（准备蓝、休息红、离线锻炼绿）。
- 记录列表与详情页在统计/采样不可用时显示 N/A，避免离线数据缺失导致空白。
- 训练监控离线模式停止生成模拟采样与折线数据，不再创建分组采样。
- 训练监控页新增中途退出记录逻辑，按阶段计算已完成循环并生成记录。
- 训练监控总时长改为累计已进行的锻炼/休息时间，排除准备与暂停，并支持未完成阶段的部分计入。
- 设备已连接时，锻炼阶段中途退出也会保存当前循环的部分采样数据。
- 训练监控页拦截系统返回并复用退出保存逻辑，锻炼阶段退出时确保当前循环分组也被写入记录。
- 锻炼阶段退出时强制补齐当前循环分组，避免部分采样因判空而遗漏。
- 训练记录恢复逻辑改为合并已有状态，避免首次训练中途退出时被异步恢复覆盖而丢失。
- 训练监控页退出时改为进入结算页，并在结算页提供“直接退出/保存并退出”双按钮。
- 训练监控折线末端新增与线条同色的圆点标记，强调最新数据位置。
- 训练监控折线末端圆点增加白色同心圆内芯。
- 训练监控折线末端圆点绘制顺序调整为覆盖 MAX 点。
- 训练监控折线填充改为自上而下渐变，底部过渡为白色。
- 训练监控折线渐变底色改为跟随图表背景色。
- 训练监控实时数值新增与进度条背景同色的底部填充块，并使用顶部内圆角与底部外圆角造型。
- 训练监控底部实时拉力数值与单位拆分样式显示，数值加粗16号，单位14号灰色。
- 训练监控底部实时拉力增加固定宽度白色背景块并加入圆角。
- 调整实时拉力展示层级，将容器外移以便内层保留 padding。
- 实时拉力背景块改为自适应高度，padding 调整为上6下12。
- 修复实时拉力背景块因 alignment 填满父容器的问题，改为仅内容居中。
- 实时拉力背景块内层改为使用带 heightFactor 的 Align，避免子组件撑满高度。
- 实时拉力背景块底部圆角改为外扩曲线，使用自定义绘制徽章实现平滑外过渡。
- 移除训练监控图表 MAX 值竖线及其相关绘制逻辑，改为仅保留折线与末端点。
- 调整训练监控模拟采样：频率改为0.05秒，并加入分阶段的VMAX/VMIN、稳定/不稳定与力竭状态逻辑。
- 锻炼阶段稳定波动改为正负1.5kg，并增强上升/下降阶段的单调波动幅度。
- 启动阶段采样改为随机缩小0-3次增量至10%-30%，剩余增量顺延到下一次采样。
- 下降阶段同样采用增量缩小并顺延的随机逻辑，覆盖不稳定下降与力竭快速下降。
- 不稳定阶段T范围改为进入不稳定后才逐步放宽，上限随每次不稳定循环增加，并将进入不稳定的循环数设为总次数的40-60%随机值。
- 不稳定状态下降到最小值后改为围绕最小值正负1.5kg波动。
- 移除训练监控页未使用的_noisyMonotonic方法。
- 训练监控首轮锻炼生成跟随至锁定的最大值水平点线，并以该最大值固定缩放Y轴到60%位置。
- 最大值水平线与显示进度同步，达到显示进度后再锁定。
- 最大值锁定改为基于平滑后的显示值，避免水平线与折线显示不同步。
- 最大值水平线默认设为10kg，实时折线超出时同步抬高水平线与Y轴缩放。
- Y轴缩放与最大值水平线增加缓动过渡动画，避免跳变。
- 最大值水平线改为稳定窗口均值锁定：原始值在5%波动内稳定1.5秒后取0.5-1.5秒均值固定，并取消实时跟踪。
- 首轮锻炼结束时固定当前Y轴缩放与水平线，后续不再更新。
- 最大值水平线在所有阶段保持显示。
- 首轮锻炼完成后，后续各阶段Y轴缩放保持一致，不随阶段切换变化。
- 水平线右侧上方新增 MAX 数值文本标注。
- 最大值的60%与20%位置新增水平线，并在右侧显示对应百分比文本。
- 训练监控实时数值下方新增当前值与最大值的百分比显示。
- 训练监控进度条文本增加被覆盖区域的裁剪高亮，覆盖部分逐渐显示为白色。
- 修正监控图表追加点位时多余的 lastValue 传参，移除未使用的回调以消除未定义标识符报错。
- 新增训练统计计算服务与 Provider，按训练统计说明计算持续阶段、控制指标与力竭相关统计。
- 训练记录模型补充循环级统计与会话级统计字段，并兼容旧统计字段反序列化。
- 训练结算页改为展示最大力量、最大控制力量、控制循环数、力竭信号、最低控制力量与降幅统计。
- 训练记录列表与详情页同步展示新统计字段，并增加百分比与缺失值格式化处理。
- 自由训练模式新增实时监控右侧面板，显示最大值/均值/总时长并提供重置与开始/暂停按钮。
- 自由训练监控改为独立布局，无顶部标题与工具栏，实时曲线仅显示最近10秒数据。
- 自由训练竖屏时将数值面板置于折线图上方，横屏时悬浮在右侧并限制折线绘制宽度避免遮挡。
- 折线图水平线与百分比标注改为左侧绘制。
- 自由训练竖屏时实时数据面板移至屏幕底部显示。
- 监控页左上角补充退出按钮，自由训练同样可快速退出。\n- MAX水平线位置按总高度70%%映射，水平线文字绘制到折线上方。
- 折线首个采样点补零秒锚点，消除左侧空隙并保持起始段连续显示。
- 折线绘制右侧预留8px留白，与实时面板默认padding一致，背景仍铺满屏幕。
- 水平线与百分比线改为绘制到全屏宽度，随背景铺满显示。
- 自由训练数值面板新增鲁棒最大/最大控制力/控制时间占比/1秒均值与变化统计，并改为双栏显示。
- 修复自由训练统计窗口常量计算的常量表达式报错，改为固定20个采样点。
- 自由训练统计窗口采样点数改为运行时计算，避免常量表达式报错。
- 自由训练实时面板仅保留7项指标，限制最大高度为屏幕50%，超出时指标区域可滚动。
- 自由训练面板按钮栏固定，指标区域超高时可滚动。\n- 自由训练模拟数据改为每5秒更换10-60kg基准，20%%范围波动且单次变化不超上一采样5%%。
- 自由训练控制时间改为单次连续最长时长（按阈值连续样本计算），不再累计总时长。
- 自由训练面板“连续控制时间”文案改为“最长连续控制时间”。
- 自由训练控制时间逻辑明确为最长连续时长，并重命名字段以匹配显示含义。
- 自由训练1s增幅/降幅改为显示绝对数值（kg），不再使用百分比。
- 自由训练实时面板右上角新增问号按钮，弹窗展示各指标说明。
- 调整指标面板问号按钮到标题右侧对齐显示。
- 监控水平线标签由 MAX 改为 PEAK。
- 指标面板问号按钮改为右侧对齐，确保与指标文本最右侧对齐。
- 自由训练横屏面板宽度改为动态测量，指标单列展示，最大高度限制在安全区内并保持可滚动。
- 自由训练指标面板标签与数值间距调整为至少20px。
- 自由训练退出新增保存页，标题默认“自由训练”可编辑，指标展示沿用实时面板并支持保存本地。
- 实时面板标题居中，按钮行增加左右内边距。
- 结算页标题居中显示，按钮行增加左右边距。
- 修复自由训练结算页标题未居中问题，PlanNameRow 支持居中显示并在结算页启用。
- 结算页居中标题的编辑图标回到标题右侧紧贴显示。
- PlanNameRow 居中布局忽略图标宽度，标题居中后再将编辑图标紧贴右侧显示。\n- 记录页新增自由训练记录展示与删除支持。
- 修复结算页标题居中布局在无界约束下导致的卡顿问题，居中计算改用有限宽度并保持图标紧贴标题。
- 自由训练结算页标题输入框改为居中文本，图标仍按标题宽度右侧定位。
- 结算页标题居中时改为先居中标题再定位右侧图标，避免图标宽度影响居中。
- 自由训练结算页标题改为使用 TextFormField，标签为“标题”，移除编辑图标，默认值为“自由训练”。
- 监控页底部实时数值块在高度不足时改为缩放显示，避免 Column 轻微溢出。
- 自由训练首页未连接设备时开始按钮置灰，点击弹窗提示“请连接设备”。
- 自由训练首页与监控页未连接设备时开始按钮禁用不可点击。
- 自由训练首页与监控页未连接设备时开始按钮下方增加轻提示文案。
- 自由训练首页与监控页未连接设备时提示文案调整到开始按钮上方。
- 自由训练监控页实时数值块恢复按内容尺寸收缩，避免占满高度。
- 自由训练竖屏实时面板移除指标与数值之间的固定间隔。
- 记录页同时展示自由训练与计时训练记录，并支持各自删除。
- 自由训练记录卡片支持点击进入详情页查看指标。

## [v0.0.2] 2026.01.21 - now

- 重写 AGENT.md 设计规范草案- 重构目录为 `lib/src/views` 与 `lib/src/providers`，训练计划与监控页面调整为 Page/View/Widget 分层，影响训练计划页、监控页、记录页。
- 训练监控逻辑迁移到 `TrainingMonitorController` + `TrainingMonitorState`，页面仅保留渲染与交互分发，影响训练监控流程与数据保存入口。
- 拆分超长文件：监控页头部/图表绘制/自由训练面板与计划选择弹窗拆分为独立组件，训练统计计算器拆出辅助文件。
- 数据结构变化：`ChartSample` 与 `TrainingSummary` 移入 models；无持久化字段变更，历史数据无需迁移。
- 更新规范：移除“任一 Dart 文件超过 250 行必须拆分（除非是纯模型/纯配置）”限制。
- 合并 training_monitor_controller 的分拆文件，集中到 `lib/src/providers/training_monitor_controller.dart`，并移除对应 part 文件，便于排查错误。
- 修复 TrainingMonitorController 的 Riverpod 3 API 使用方式，改为 Notifier + autoDispose family，并移除未使用的自由训练计数字段。
- 修复监控相关视图中 ValueListenable 未识别问题，补充 foundation 导入（监控视图/图表/自由训练相关组件）。
- 补充规范：使用 `ValueListenable/ValueListenableBuilder` 时需显式引入 `package:flutter/foundation.dart`，避免类型未识别。
- 修复监控图表绘制文件尾部多余括号导致的语法错误，并补充统计模型导入以消除 TrainingStatistics 未识别报错。
- 新增训练统计计算器的单元测试，覆盖空数据与疲劳判定场景，影响 services 与 models。
- 新增训练记录与统计的序列化回归测试，影响 models，未涉及数据结构变更。
- 按测试规范重建 test 目录结构，新增 helpers/fake storages，影响 tests。
- 补齐 models 单元测试（训练计划、自由训练记录、训练记录时区/序列化），影响 models。
- 补齐 services 单元测试（记录/计划存储与统计计算器），影响 services。
- 补齐 providers 主流程测试（计划、记录、监控状态机），影响 providers。
- 修复测试中 Override 类型提示与局部函数命名告警，影响 providers 单元测试。
- 新增测试依赖 fake_async 并修正 storage 测试的命名告警，影响 tests 与 pubspec。
- 修复训练计划与训练记录 storage 测试的命名告警，影响 services 单元测试。
- 修复 TrainingMonitorController 单测自动销毁导致的状态流转失败，影响 providers 单元测试。
- 修改点：新增 `lib/src/services/clock.dart` 与 `lib/src/services/random_source.dart`，新增 `lib/src/providers/system_providers.dart`，TrainingMonitorController 与 TrainingPlanLibraryController 改为可注入时间/随机源；`lib/src/models/free_training_record.dart` 与 `lib/src/models/training_record.dart` 的反序列化缺省时间改为 UTC epoch；补齐 `lib/src/views/trainer/main/widgets/training_plan_form.dart` 的 foundation 导入；新增模型测试覆盖缺省时间。
- 影响范围：涉及 services/providers/models/views/test；状态机与指标逻辑不变，时间与随机性来源改为可替换可控，数据流不变。
- 数据结构变更与迁移方式：无数据结构变化；历史数据无需迁移，缺失 `startedAt` 时默认落在 UTC epoch。
- 修改点：在记录页新增顶部日历组件，新增 `lib/src/views/record/widgets/record_calendar.dart` 并在 `lib/src/views/record/history_page.dart` 组装展示；属于 UI 结构调整。
- 修改点：记录页日历顶部新增月份导航，支持左右箭头切换月份；调整 `lib/src/views/record/widgets/record_calendar.dart` 为本地状态驱动。
- 修改点：记录页日历样式收紧（内边距、间距、字号、箭头按钮尺寸），提升紧凑度；修改 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：记录页列表外层增加顶部 SafeArea，避免内容被系统状态栏遮挡；修改 `lib/src/views/record/history_page.dart`。
- 修改点：记录页日历 cell 移除默认背景，今日日期改为灰色背景；有训练日期显示蓝色横线并置于背景之上；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：记录页日历今日标记改为红色空心圆圈，并与蓝色训练横线错开避免重叠；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：记录页日历今日标记改为红色字体显示，移除灰色背景；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：记录页日历无训练日期文字改为 `FontWeight.normal`，保留训练日期的强调权重；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：压缩记录页日历高度（缩小内边距、标题/星期字号、网格间距与比例、箭头按钮尺寸）；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：压缩日历头部高度，缩小左右箭头尺寸与标题字号；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：日历头部左右按钮改为 shrinkWrap 触控尺寸并压缩视觉密度，确保高度按约束显示；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：移除 IconButton 不支持的 `materialTapTargetSize` 参数以修复编译错误；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：记录页日历日期颜色按字体逻辑区分为蓝/黑/灰（今日蓝色、有训练黑色、无训练灰色）；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：记录页日历训练蓝线宽度改为与日期文本宽度一致，按字体样式动态测量；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：压缩记录页日历 cell 高度，增大网格宽高比并下移蓝线间距；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：记录页日历头部与日期网格之间新增分割线；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：记录页日历标题支持点击弹出年月轮盘选择器，包含“今日”和“确定”按钮；新增 `_MonthPickerSheet` 并在 `lib/src/views/record/widgets/record_calendar.dart` 中接入。
- 修改点：年月轮盘仅显示数字，单位“年/月”改为静态标签不参与滚动；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：年月轮盘容器增加左右内边距，避免贴边显示；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：轮盘布局调整为年/月各自列内包含数字与单位，确保两列等宽；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：将星期与日期网格封装为 `_CalendarBody`，并为日历主体单独设置左右内边距；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：日历主体 cell 文本改为使用 Stack 居中对齐，确保文字居中显示；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：日历主体星期行改为与日期网格同样的 7 列网格布局，统一列宽以对齐；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：日历标题年月增加下拉箭头图标，强化可点击提示；更新 `lib/src/views/record/widgets/record_calendar.dart`。
- 修改点：记录页日历下方新增自由训练/计时训练可切换面板，列表按选中面板展示并提供各自空态提示；更新 `lib/src/views/record/history_page.dart`。
- 修改点：记录页日历与记录列表上方新增分区标题“训练日历”“记录”；更新 `lib/src/views/record/history_page.dart`。
- 修改点：记录页切换控件改为 TabBar 样式，使用标签切换自由训练/计时训练列表展示；更新 `lib/src/views/record/history_page.dart`。
- 修改点：记录页切换控件改为默认 TabBar 样式，移除自定义容器与指示器样式；更新 `lib/src/views/record/history_page.dart`。
- 修改点：记录页移除 TabBar 切换，改为按日期分组的横向滑动卡片列表展示自由/计时训练；更新 `lib/src/views/record/history_page.dart`。
- 修改点：记录页移除卡片滑动删除；当日记录改用 `CarouselView` 横向展示；更新 `lib/src/views/record/history_page.dart`。
- 修改点：记录页当日 CarouselView 使用权重布局，权重为 [4,1] 且初始显示第一个；当日仅一条记录时改为单列满宽展示；更新 `lib/src/views/record/history_page.dart`。
- 修改点：移除训练记录卡片点击交互与详情跳转；更新 `lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`、`lib/src/views/record/history_page.dart`。
- 修改点：记录卡片在 CarouselView 缩放时限制标题与统计文本为单行省略，并使用等分列避免溢出；更新 `lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。
- 修改点：记录页当日横向列表移除 CarouselView，改为普通横向 ListView；更新 `lib/src/views/record/history_page.dart`。
- 修改点：记录区标题改为下拉选择器，可切换“计时训练记录/自由训练记录”，默认计时训练记录；记录列表按选择过滤；更新 `lib/src/views/record/history_page.dart`。
- 修改点：计时训练记录卡片新增“详情”按钮并跳转训练详情页；更新 `lib/src/views/record/widgets/record_card.dart`。
- 修改点：计时训练记录卡片详情入口改为右箭头图标按钮；更新 `lib/src/views/record/widgets/record_card.dart`。
- 修改点：计时训练记录卡片中部新增循环平均力量柱状图展示；更新 `lib/src/views/record/widgets/record_card.dart`。
- 修改点：柱状图根据卡片可用宽度动态计算柱宽与间距，限制总宽度不超出列表项；更新 `lib/src/views/record/widgets/record_card.dart`。
- 修改点：移除计时训练记录卡片右侧详情按钮，改为整卡点击跳转详情页；更新 `lib/src/views/record/widgets/record_card.dart`。
- 修改点：记录页横向列表移除固定高度，改为水平滚动行以便卡片高度随内容自适应；更新 `lib/src/views/record/history_page.dart`。
- 修改点：计时训练记录卡片改为展示最大力量/力竭信号/降幅标准差；训练详情页新增指标说明问号弹窗；更新 `lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/training_record_detail_page.dart`。
- 修改点：指标说明补充计算方式描述，便于理解指标来源；更新 `lib/src/views/record/training_record_detail_page.dart`。
- 修改点：指标说明补充算法细节的文字解释，明确筛选范围与阈值规则；更新 `lib/src/views/record/training_record_detail_page.dart`。
- 修改点：记录页新增右侧筛选面板与过滤逻辑，支持训练类型/指标摘要/柱状图指标配置；记录卡片与自由训练卡片按选项动态展示指标与柱状图；新增 `lib/src/views/record/record_filter_options.dart`，更新 `lib/src/views/record/history_page.dart`、`lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。
- 修改点：过滤弹窗新增底部“应用”按钮并按应用结果更新记录列表；指标摘要显示二级标题；摘要指标扩展为详情页全部指标；更新 `lib/src/views/record/history_page.dart`、`lib/src/views/record/record_filter_options.dart`、`lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。
- 修改点：过滤弹窗新增重置按钮，并设定默认筛选为计时训练/指定摘要指标/柱状图最大力量；更新 `lib/src/views/record/history_page.dart`。
- 修改点：柱状图默认指标改为平均力量，并同步重置默认值；更新 `lib/src/views/record/history_page.dart`。
- 修改点：记录列表卡片宽度改为屏幕可用宽度的90%；更新 `lib/src/views/record/history_page.dart`。
- 修改点：记录列表卡片宽度改为固定300；更新 `lib/src/views/record/history_page.dart`。
- 修改点：自由训练记录新增采样数据持久化，并在记录卡片中展示折线缩略图；更新 `lib/src/models/free_training_record.dart`、`lib/src/providers/training_monitor_controller.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`、`test/models/free_training_record_test.dart`、`test/services/free_training_record_storage_test.dart`。
- 影响范围：models / providers / views / services / tests；新增自由训练采样数据的展示与持久化，不影响计时训练状态机。
- 数据结构变更与迁移方式：`FreeTrainingRecord` 新增 `samples` 字段（`List<double>`），旧数据缺失时回退为空列表；保存时对采样做下采样以控制体积。
- 修改点：自由训练记录折线缩略图改为仅保存前60秒采样并下采样；更新 `lib/src/providers/training_monitor_controller.dart`。
- 修改点：修复自由训练缩略图宽度为0导致仅显示竖线的问题，改为按约束尺寸绘制自定义画布；更新 `lib/src/views/record/widgets/free_training_record_card.dart`。
- 修改点：自由训练缩略图改为保存与展示全程采样，并按总时长映射横轴；更新 `lib/src/providers/training_monitor_controller.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。
- 修改点：训练详情页指标说明补充更明确的算法细节措辞；更新 `lib/src/views/record/training_record_detail_page.dart`。
- 修改点：计时训练记录卡片在无图表数据时显示“暂无曲线”提示，与自由训练样式一致；更新 `lib/src/views/record/widgets/record_card.dart`。
- 修改点：记录页在训练日历与记录列表之间新增计时训练最大力量折线数据总览；更新 `lib/src/views/record/history_page.dart`。
- 修改点：训练详情页指标说明弹窗禁止点击遮罩关闭；更新 `lib/src/views/record/training_record_detail_page.dart`。（修复）
- 修改点：新增指标定义与可见性配置数据结构，统一管理计划/自由训练指标文案与说明；新增 `lib/src/models/metric_definitions.dart`、`lib/src/providers/metric_visibility_provider.dart`。（结构调整）
- 修改点：结算页/过滤页/详情页按指标可见性配置渲染；指标说明与列表改为读取统一定义；更新 `lib/src/views/record/history_page.dart`、`lib/src/views/record/training_record_detail_page.dart`、`lib/src/views/record/free_training_record_detail_page.dart`、`lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`、`lib/src/views/trainer/monitor/widgets/monitor_summary_overlay.dart`、`lib/src/views/trainer/monitor/widgets/free_training_summary_overlay.dart`、`lib/src/views/trainer/monitor/widgets/free_training_data_panel.dart`；移除 `lib/src/views/record/record_filter_options.dart`。（重构）
- 修改点：新增指标可见性 provider 测试，确保默认启用与可更新行为；新增 `test/providers/metric_visibility_provider_test.dart`。（测试）
- 修改点：指标可见性 provider 改为 Notifier/NotifierProvider 以兼容现有 Riverpod 3 约定；更新 `lib/src/providers/metric_visibility_provider.dart`。（修复）
- 修改点：修复记录页日期格式插值警告并接入 RadioGroup 去除过时 API 提示；更新 `lib/src/views/record/history_page.dart`。（修复）
- 修改点：指标定义新增 `shortLabel`，记录列表卡片使用短标题显示，其余位置保持原标签；更新 `lib/src/models/metric_definitions.dart`、`lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。（结构调整）
- 修改点：指标定义移除 `helpLabel` 并统一使用 `label` 展示；更新 `lib/src/models/metric_definitions.dart`、`lib/src/views/record/training_record_detail_page.dart`、`lib/src/views/trainer/monitor/widgets/free_training_data_panel.dart`。（结构调整）
- 修改点：指标说明支持额外补充条目，仅在说明弹窗中展示；新增 `MetricGuideDefinition` 与补充定义列表；更新 `lib/src/models/metric_definitions.dart`、`lib/src/views/record/training_record_detail_page.dart`、`lib/src/views/trainer/monitor/widgets/free_training_data_panel.dart`。（结构调整）
- 修改点：力竭信号基准力量改为取前两轮持续阶段中 ≥0.95 最大力量的采样集合中位数，并更新文档说明；更新 `lib/src/services/training_statistics_calculator.dart`、`docs/timer_metrics.md`。（修复）
- 修改点：记录页筛选默认计时训练指标改为最大控制力量/最低控制力量/力竭信号；更新 。（调整）
- 修改点：记录页筛选默认计时训练指标改为最大控制力量/最低控制力量/力竭信号；更新 `lib/src/views/record/history_page.dart`。（调整）
- 修改点：指标说明弹窗按“定义/指标”分组展示，先显示定义再显示指标；更新 `lib/src/views/record/training_record_detail_page.dart`。（调整）
- 修改点：自由训练面板的指标说明弹窗样式对齐记录详情页，按“定义/指标”分组且禁止点击遮罩关闭；更新 `lib/src/views/trainer/monitor/widgets/free_training_data_panel.dart`、`lib/src/views/trainer/monitor/widgets/free_training_panel_widgets.dart`。（调整）
- 修改点：指标说明弹窗在仅有指标无定义时隐藏“指标”小标题；更新 `lib/src/views/record/training_record_detail_page.dart`、`lib/src/views/trainer/monitor/widgets/free_training_data_panel.dart`。（调整）
- 修改点：记录页列表卡片右上角新增可点击提示图标，并为自由训练卡片补充点击进入详情页；更新 `lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。（调整）
- 修改点：记录列表计时训练卡片的时间行右侧追加计划设置与总时长信息；更新 `lib/src/views/record/widgets/record_card.dart`。（调整）
- 修改点：记录卡片统计指标区域改为根据可用宽度自适应列宽与列数；更新 `lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。（调整）
- 修改点：记录卡片统计指标区域的列间距改为自动填充剩余宽度；更新 `lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。（调整）
- 修改点：记录卡片统计指标区域使用 Spacer 均分列间距；更新 `lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。（调整）
- 修改点：记录卡片统计指标列宽计算补充 double 转换以修复类型错误；更新 `lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。（修复）
- 修改点：记录卡片统计指标固定每行3个，并使用 Spacer 自动均分列间距；更新 `lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。（调整）
- 修改点：记录卡片统计指标列宽不再使用 96 上限，改为按可用宽度等分；更新 `lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。（调整）
- 修改点：记录卡片统计指标文字居中，列宽改为自适应子元素宽度并均匀分布；更新 `lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。（调整）
- 修改点：记录列表卡片支持长按删除，确认后调用对应 provider 移除记录；更新 `lib/src/views/record/history_page.dart`、`lib/src/views/record/widgets/record_card.dart`、`lib/src/views/record/widgets/free_training_record_card.dart`。（功能）
